From 3c7cad6a8fae61aefad4a55e3432b0a05300e1e6 Mon Sep 17 00:00:00 2001
From: atamazov <artem.tamazov@gmail.com>
Date: Fri, 7 Oct 2022 21:47:23 +0300
Subject: [PATCH] Workaround for the bug in the llvm::msgpack, when N is
 recognized as "false", a boolean type instead of string type.

---
 src/kernels/Conv_Winograd_v13_3_12_epilogue.inc       | 2 +-
 src/kernels/Conv_Winograd_v16_5_0_epilogue.inc        | 2 +-
 src/kernels/Conv_Winograd_v21_1_3_metadata.inc        | 2 +-
 src/kernels/conv1x1u.s                                | 2 +-
 src/kernels/conv1x1u_bias_activ.s                     | 2 +-
 src/kernels/conv1x1u_stride2.s                        | 2 +-
 src/kernels/conv1x1wrw.s                              | 2 +-
 src/kernels/conv3x3wrw.s                              | 2 +-
 src/kernels/conv_3x3_wheel_alpha_v3_0b_epilogue.inc   | 2 +-
 src/kernels/conv_3x3_wheel_alpha_v7_0_3b_epilogue.inc | 2 +-
 src/kernels/conv_3x3_wheel_alpha_v9_0_15_epilogue.inc | 2 +-
 src/kernels/conv_3x3_wheel_alpha_v9_2_7_epilogue.inc  | 2 +-
 src/kernels/xform_bidirect_winograd_code.inc          | 2 +-
 src/kernels/xform_metadata.inc                        | 2 +-
 14 files changed, 14 insertions(+), 14 deletions(-)

diff --git a/src/kernels/Conv_Winograd_v13_3_12_epilogue.inc b/src/kernels/Conv_Winograd_v13_3_12_epilogue.inc
index 71b2cabf16..64b7c9e624 100644
--- a/src/kernels/Conv_Winograd_v13_3_12_epilogue.inc
+++ b/src/kernels/Conv_Winograd_v13_3_12_epilogue.inc
@@ -76,7 +76,7 @@ amdhsa.kernels:
     .max_flat_workgroup_size: \wg_x
     .wavefront_size: 64
     .args:
-    - { .size: 4, .offset: 0,   .value_kind: by_value,      .value_type: i32, .name: N }
+    - { .size: 4, .offset: 0,   .value_kind: by_value,      .value_type: i32, .name: BATCHSIZE }
     - { .size: 4, .offset: 4,   .value_kind: by_value,      .value_type: i32, .name: C }
     - { .size: 4, .offset: 8,   .value_kind: by_value,      .value_type: i32, .name: H }
     - { .size: 4, .offset: 12,  .value_kind: by_value,      .value_type: i32, .name: W }
diff --git a/src/kernels/Conv_Winograd_v16_5_0_epilogue.inc b/src/kernels/Conv_Winograd_v16_5_0_epilogue.inc
index 36d47c862a..95f5636c76 100644
--- a/src/kernels/Conv_Winograd_v16_5_0_epilogue.inc
+++ b/src/kernels/Conv_Winograd_v16_5_0_epilogue.inc
@@ -76,7 +76,7 @@ amdhsa.kernels:
     .max_flat_workgroup_size: \wg_x
     .wavefront_size: 64
     .args:
-    - { .size: 4, .offset: 0,   .value_kind: by_value,      .value_type: i32, .name: N }
+    - { .size: 4, .offset: 0,   .value_kind: by_value,      .value_type: i32, .name: BATCHSIZE }
     - { .size: 4, .offset: 4,   .value_kind: by_value,      .value_type: i32, .name: C }
     - { .size: 4, .offset: 8,   .value_kind: by_value,      .value_type: i32, .name: H }
     - { .size: 4, .offset: 12,  .value_kind: by_value,      .value_type: i32, .name: W }
diff --git a/src/kernels/Conv_Winograd_v21_1_3_metadata.inc b/src/kernels/Conv_Winograd_v21_1_3_metadata.inc
index deff81e84a..54394d3002 100644
--- a/src/kernels/Conv_Winograd_v21_1_3_metadata.inc
+++ b/src/kernels/Conv_Winograd_v21_1_3_metadata.inc
@@ -51,7 +51,7 @@ amdhsa.kernels:
     .max_flat_workgroup_size: \wg_x
     .wavefront_size: 64
     .args:
-    - { .size: 4, .offset:   0, .value_kind: by_value, .value_type: i32, .name: N }
+    - { .size: 4, .offset:   0, .value_kind: by_value, .value_type: i32, .name: BATCHSIZE }
     - { .size: 4, .offset:   4, .value_kind: by_value, .value_type: i32, .name: C }
     - { .size: 4, .offset:   8, .value_kind: by_value, .value_type: i32, .name: H }
     - { .size: 4, .offset:  12, .value_kind: by_value, .value_type: i32, .name: W }
diff --git a/src/kernels/conv1x1u.s b/src/kernels/conv1x1u.s
index 5dc213546a..bb31a00258 100644
--- a/src/kernels/conv1x1u.s
+++ b/src/kernels/conv1x1u.s
@@ -1076,7 +1076,7 @@ amdhsa.kernels:
     .max_flat_workgroup_size: \wg_x
     .wavefront_size: 64
     .args:
-    - { .size: 4, .offset:  0, .value_kind: by_value, .value_type: i32, .name: N }
+    - { .size: 4, .offset:  0, .value_kind: by_value, .value_type: i32, .name: BATCHSIZE }
     - { .size: 4, .offset:  4, .value_kind: by_value, .value_type: i32, .name: C }
     - { .size: 4, .offset:  8, .value_kind: by_value, .value_type: i32, .name: H }
     - { .size: 4, .offset: 12, .value_kind: by_value, .value_type: i32, .name: W }
diff --git a/src/kernels/conv1x1u_bias_activ.s b/src/kernels/conv1x1u_bias_activ.s
index 1675e819a7..d2d4b10198 100644
--- a/src/kernels/conv1x1u_bias_activ.s
+++ b/src/kernels/conv1x1u_bias_activ.s
@@ -1230,7 +1230,7 @@ amdhsa.kernels:
     .max_flat_workgroup_size: \wg_x
     .wavefront_size: 64
     .args:
-    - { .size: 4, .offset:  0, .value_kind: by_value, .value_type: i32, .name: N }
+    - { .size: 4, .offset:  0, .value_kind: by_value, .value_type: i32, .name: BATCHSIZE }
     - { .size: 4, .offset:  4, .value_kind: by_value, .value_type: i32, .name: C }
     - { .size: 4, .offset:  8, .value_kind: by_value, .value_type: i32, .name: H }
     - { .size: 4, .offset: 12, .value_kind: by_value, .value_type: i32, .name: W }
diff --git a/src/kernels/conv1x1u_stride2.s b/src/kernels/conv1x1u_stride2.s
index c5ea1e90cd..126bd2a808 100644
--- a/src/kernels/conv1x1u_stride2.s
+++ b/src/kernels/conv1x1u_stride2.s
@@ -1162,7 +1162,7 @@ amdhsa.kernels:
     .max_flat_workgroup_size: \wg_x
     .wavefront_size: 64
     .args:
-    - { .size: 4, .offset:  0, .value_kind: by_value, .value_type: i32, .name: N }
+    - { .size: 4, .offset:  0, .value_kind: by_value, .value_type: i32, .name: BATCHSIZE }
     - { .size: 4, .offset:  4, .value_kind: by_value, .value_type: i32, .name: C }
     - { .size: 4, .offset:  8, .value_kind: by_value, .value_type: i32, .name: H }
     - { .size: 4, .offset: 12, .value_kind: by_value, .value_type: i32, .name: W }
diff --git a/src/kernels/conv1x1wrw.s b/src/kernels/conv1x1wrw.s
index b13b6ffa44..f2c88fce88 100644
--- a/src/kernels/conv1x1wrw.s
+++ b/src/kernels/conv1x1wrw.s
@@ -1243,7 +1243,7 @@ amdhsa.kernels:
     .max_flat_workgroup_size: \wg_x
     .wavefront_size: 64
     .args:
-    - { .size: 4, .offset:  0, .value_kind: by_value, .value_type: i32, .name: N }
+    - { .size: 4, .offset:  0, .value_kind: by_value, .value_type: i32, .name: BATCHSIZE }
     - { .size: 4, .offset:  4, .value_kind: by_value, .value_type: i32, .name: C }
     - { .size: 4, .offset:  8, .value_kind: by_value, .value_type: i32, .name: H }
     - { .size: 4, .offset: 12, .value_kind: by_value, .value_type: i32, .name: W }
diff --git a/src/kernels/conv3x3wrw.s b/src/kernels/conv3x3wrw.s
index a3f73aeaeb..e8179f66d9 100755
--- a/src/kernels/conv3x3wrw.s
+++ b/src/kernels/conv3x3wrw.s
@@ -1033,7 +1033,7 @@ amdhsa.kernels:
     .max_flat_workgroup_size: \wg_x
     .wavefront_size: 64
     .args:
-    - { .size: 4, .offset:  0, .value_kind: by_value, .value_type: i32, .name: N }
+    - { .size: 4, .offset:  0, .value_kind: by_value, .value_type: i32, .name: BATCHSIZE }
     - { .size: 4, .offset:  4, .value_kind: by_value, .value_type: i32, .name: C }
     - { .size: 4, .offset:  8, .value_kind: by_value, .value_type: i32, .name: H }
     - { .size: 4, .offset: 12, .value_kind: by_value, .value_type: i32, .name: W }
diff --git a/src/kernels/conv_3x3_wheel_alpha_v3_0b_epilogue.inc b/src/kernels/conv_3x3_wheel_alpha_v3_0b_epilogue.inc
index 358772e63f..4589c51e69 100644
--- a/src/kernels/conv_3x3_wheel_alpha_v3_0b_epilogue.inc
+++ b/src/kernels/conv_3x3_wheel_alpha_v3_0b_epilogue.inc
@@ -76,7 +76,7 @@ amdhsa.kernels:
     .max_flat_workgroup_size: \wg_x
     .wavefront_size: 64
     .args:
-    - { .size: 4, .offset: 0,   .value_kind: by_value,      .value_type: i32, .name: N }
+    - { .size: 4, .offset: 0,   .value_kind: by_value,      .value_type: i32, .name: BATCHSIZE }
     - { .size: 4, .offset: 4,   .value_kind: by_value,      .value_type: i32, .name: C }
     - { .size: 4, .offset: 8,   .value_kind: by_value,      .value_type: i32, .name: H }
     - { .size: 4, .offset: 12,  .value_kind: by_value,      .value_type: i32, .name: W }
diff --git a/src/kernels/conv_3x3_wheel_alpha_v7_0_3b_epilogue.inc b/src/kernels/conv_3x3_wheel_alpha_v7_0_3b_epilogue.inc
index d3296969ab..9e163a63bf 100644
--- a/src/kernels/conv_3x3_wheel_alpha_v7_0_3b_epilogue.inc
+++ b/src/kernels/conv_3x3_wheel_alpha_v7_0_3b_epilogue.inc
@@ -76,7 +76,7 @@ amdhsa.kernels:
     .max_flat_workgroup_size: \wg_x
     .wavefront_size: 64
     .args:
-    - { .size: 4, .offset: 0,   .value_kind: by_value,      .value_type: i32, .name: N }
+    - { .size: 4, .offset: 0,   .value_kind: by_value,      .value_type: i32, .name: BATCHSIZE }
     - { .size: 4, .offset: 4,   .value_kind: by_value,      .value_type: i32, .name: C }
     - { .size: 4, .offset: 8,   .value_kind: by_value,      .value_type: i32, .name: H }
     - { .size: 4, .offset: 12,  .value_kind: by_value,      .value_type: i32, .name: W }
diff --git a/src/kernels/conv_3x3_wheel_alpha_v9_0_15_epilogue.inc b/src/kernels/conv_3x3_wheel_alpha_v9_0_15_epilogue.inc
index a253cc0f93..f24a643da6 100644
--- a/src/kernels/conv_3x3_wheel_alpha_v9_0_15_epilogue.inc
+++ b/src/kernels/conv_3x3_wheel_alpha_v9_0_15_epilogue.inc
@@ -76,7 +76,7 @@ amdhsa.kernels:
     .max_flat_workgroup_size: \wg_x
     .wavefront_size: 64
     .args:
-    - { .size: 4, .offset: 0,   .value_kind: by_value,      .value_type: i32, .name: N }
+    - { .size: 4, .offset: 0,   .value_kind: by_value,      .value_type: i32, .name: BATCHSIZE }
     - { .size: 4, .offset: 4,   .value_kind: by_value,      .value_type: i32, .name: C }
     - { .size: 4, .offset: 8,   .value_kind: by_value,      .value_type: i32, .name: H }
     - { .size: 4, .offset: 12,  .value_kind: by_value,      .value_type: i32, .name: W }
diff --git a/src/kernels/conv_3x3_wheel_alpha_v9_2_7_epilogue.inc b/src/kernels/conv_3x3_wheel_alpha_v9_2_7_epilogue.inc
index e40ac1f601..534f1734e7 100644
--- a/src/kernels/conv_3x3_wheel_alpha_v9_2_7_epilogue.inc
+++ b/src/kernels/conv_3x3_wheel_alpha_v9_2_7_epilogue.inc
@@ -76,7 +76,7 @@ amdhsa.kernels:
     .max_flat_workgroup_size: \wg_x
     .wavefront_size: 64
     .args:
-    - { .size: 4, .offset: 0,   .value_kind: by_value,      .value_type: i32, .name: N }
+    - { .size: 4, .offset: 0,   .value_kind: by_value,      .value_type: i32, .name: BATCHSIZE }
     - { .size: 4, .offset: 4,   .value_kind: by_value,      .value_type: i32, .name: C }
     - { .size: 4, .offset: 8,   .value_kind: by_value,      .value_type: i32, .name: H }
     - { .size: 4, .offset: 12,  .value_kind: by_value,      .value_type: i32, .name: W }
diff --git a/src/kernels/xform_bidirect_winograd_code.inc b/src/kernels/xform_bidirect_winograd_code.inc
index 724845f499..6865cc0e0a 100644
--- a/src/kernels/xform_bidirect_winograd_code.inc
+++ b/src/kernels/xform_bidirect_winograd_code.inc
@@ -1566,7 +1566,7 @@ amdhsa.kernels:
     .max_flat_workgroup_size: \wg_x
     .wavefront_size: 64
     .args:
-    - { .size: 4, .offset:   0, .value_kind: by_value, .value_type: i32, .name: N }
+    - { .size: 4, .offset:   0, .value_kind: by_value, .value_type: i32, .name: BATCHSIZE }
     - { .size: 4, .offset:   4, .value_kind: by_value, .value_type: i32, .name: C }
     - { .size: 4, .offset:   8, .value_kind: by_value, .value_type: i32, .name: H }
     - { .size: 4, .offset:  12, .value_kind: by_value, .value_type: i32, .name: W }
diff --git a/src/kernels/xform_metadata.inc b/src/kernels/xform_metadata.inc
index 960a9a2d82..46968cafb2 100644
--- a/src/kernels/xform_metadata.inc
+++ b/src/kernels/xform_metadata.inc
@@ -74,7 +74,7 @@ amdhsa.kernels:
     .max_flat_workgroup_size: \wg_x
     .wavefront_size: 64
     .args:
-    - { .size: 4, .offset:   0, .value_kind: by_value, .value_type: i32, .name: N }
+    - { .size: 4, .offset:   0, .value_kind: by_value, .value_type: i32, .name: BATCHSIZE }
     - { .size: 4, .offset:   4, .value_kind: by_value, .value_type: i32, .name: C }
     - { .size: 4, .offset:   8, .value_kind: by_value, .value_type: i32, .name: H }
     - { .size: 4, .offset:  12, .value_kind: by_value, .value_type: i32, .name: W }
